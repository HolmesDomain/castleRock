<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>HTMX Basic Page</title>
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>
        <style>
            body {
                margin: 0;
                padding: 0;
                background-color: white;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #frame {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div id="frame" style="width: 468px">
            <iframe
                data-aa="2403936"
                src="//ad.a-ads.com/2403936?size=728x90"
                style="
                    width: 728px;
                    height: 90px;
                    border: 0px;
                    padding: 0;
                    overflow: hidden;
                    background-color: transparent;
                "
            ></iframe>
            ><a>
                style="display: block; text-align: right; font-size: 12px"
                id="frame-link"
                href="https://aads.com/campaigns/new/?source_id=2404102&source_type=ad_unit&partner=2404102"
                >Advertise here</a
            >
        </div>

        <script>
            // Load BotD once
            const botdPromise = import("https://openfpcdn.io/botd/v1").then(
                (Botd) => Botd.load(),
            );

            // Detect and store result
            botdPromise
                .then((botd) => botd.detect())
                .then((result) => {
                    console.log("Bot detected?", result.bot);
                    window.__isBot = result.bot ? "1" : "0";
                });

            // Add Bot status to all HTMX requests
            document.body.addEventListener(
                "htmx:beforeRequest",
                function (evt) {
                    if (window.__isBot !== undefined) {
                        evt.detail.xhr.setRequestHeader(
                            "X-Bot-Detected",
                            window.__isBot,
                        );
                    }
                },
            );

            // Optional: re-run BotD detection on content change
            document.body.addEventListener("htmx:afterSwap", function () {
                botdPromise
                    .then((botd) => botd.detect())
                    .then((result) => {
                        console.log("Bot after swap?", result.bot);
                        window.__isBot = result.bot ? "1" : "0";
                    });
            });
        </script>
    </body>
</html>
